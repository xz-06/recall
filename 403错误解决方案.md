# 🔧 403 Forbidden 错误解决方案

## ❌ 错误信息

```
Unexpected token 'F', "Forbidden "... is not valid JSON
```

这个错误表示：
1. API返回了403 Forbidden状态码
2. 响应不是JSON格式，而是文本"Forbidden"
3. 前端尝试解析JSON时失败

---

## 🔍 可能的原因

### 1. GITHUB_TOKEN权限不足

**问题**：GitHub Token没有足够的权限访问仓库

**解决方案**：
1. 访问：https://github.com/settings/tokens
2. 找到你的Personal Access Token
3. 检查权限范围，确保勾选了：
   - ✅ `repo` (完整仓库访问权限)
   - ✅ `workflow` (如果需要GitHub Actions)

### 2. GITHUB_TOKEN未配置或配置错误

**问题**：Vercel项目中没有配置GITHUB_TOKEN环境变量

**解决方案**：
1. 访问：https://vercel.com/qs-projects-8a963961/recall/settings/environment-variables
2. 检查是否有 `GITHUB_TOKEN` 环境变量
3. 如果没有，点击"Add New"添加：
   - Key: `GITHUB_TOKEN`
   - Value: 你的GitHub Personal Access Token
   - Environment: Production, Preview, Development（全选）

### 3. Token已过期或被撤销

**问题**：Token已过期或被撤销

**解决方案**：
1. 生成新的Personal Access Token：
   - 访问：https://github.com/settings/tokens/new
   - 名称：`recall-memories`
   - 过期时间：选择合适的时间（建议90天或更长）
   - 权限：勾选 `repo`
   - 点击"Generate token"
2. 复制新Token
3. 在Vercel中更新 `GITHUB_TOKEN` 环境变量
4. 重新部署

---

## ✅ 已修复的问题

1. **错误处理改进**：
   - ✅ 前端现在会检查响应内容类型
   - ✅ 如果不是JSON，会先获取文本内容
   - ✅ 根据状态码提供更详细的错误信息

2. **API错误响应**：
   - ✅ 确保所有错误都返回JSON格式
   - ✅ 根据GitHub API错误状态码返回相应的HTTP状态码
   - ✅ 提供更详细的错误信息

---

## 🧪 测试步骤

1. **检查Vercel环境变量**：
   - 访问：https://vercel.com/qs-projects-8a963961/recall/settings/environment-variables
   - 确认 `GITHUB_TOKEN` 存在且正确

2. **测试上传**：
   - 访问：https://recall-self.vercel.app/upload
   - 填写表单并上传
   - 如果仍有403错误，检查浏览器控制台的详细错误信息

3. **检查GitHub Token权限**：
   - 访问：https://github.com/settings/tokens
   - 确认Token有 `repo` 权限

---

## 📋 常见错误信息对照

| HTTP状态码 | 错误信息 | 解决方案 |
|-----------|---------|---------|
| 401 | 认证失败 | 检查GITHUB_TOKEN是否正确 |
| 403 | 访问被拒绝 | 检查Token是否有repo权限 |
| 404 | 仓库不存在 | 检查仓库名称和所有者是否正确 |
| 500 | 服务器错误 | 检查Vercel日志 |

---

💡 **提示**：如果问题持续，请检查Vercel Function日志获取更详细的错误信息。

